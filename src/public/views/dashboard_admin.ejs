<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        img.thumbnail {
            width: 30px;
            height: 30px;
            object-fit: cover;
        }
    </style>
    <link rel="stylesheet" href="../css/listadoProductos.css">
    <link rel="stylesheet" href="/css/modoOscuro.css">
</head>
<body>
    <nav class="navbar py-4">
        <img src="../assets/logo.png" alt="Logo" class="logo-welcome">        
        <!-- <input type="text" placeholder="Search..." class="search-bar container mb-3""> -->        
        <div class="d-flex align-items-center gap-3">
            <!-- Switch modo claro/oscuro -->
            <div class="form-check form-switch mb-0">
                <input class="form-check-input" type="checkbox" role="switch" id="modoToggle">
                <label class="form-check-label" for="modoToggle">üåô</label>
            </div>
        </div>
    </nav>
  <div class="container my-5">
    <h2 class="mb-4 text-center">Productos Registrados</h2>
    <div>
        <a href="/admin/productos/nuevo-producto" class="btn btn-success w-25">Agregar producto</a>
    </div>
    <table class="table table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Imagen</th>
          <th>SKU</th>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Categor√≠a</th>
          <th>Activo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <% productos.forEach((producto, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td><img src="<%= producto.imagen %>" alt="img" class="thumbnail" /></td>
            <td><%= producto.sku %></td>
            <td><%= producto.nombre %></td>
            <td>$<%= producto.precio_normal %></td>
            <td><%= producto.categoria %></td>
            <td><%= producto.activo ? 'Si' : 'No' %></td>
            <td>
              <button class="btn btn-sm btn-warning me-2 w-100" onclick="editarProducto(<%= producto.id %>)">Editar</button>
              <button class="btn btn-sm btn-danger w-100" onclick="inactivarProducto(<%= producto.id %>)">Inactivar</button>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  <script>
    function editarProducto(id) {
      alert(`Editar producto con ID: ${id}`);
      window.location.href = `/admin/productos/${id}/editar/`;
    }
    async function inactivarProducto(id) {
      const confirmado = confirm("¬øSeguro que quer√©s inactivar este producto?");
      if (!confirmado) return;
      try {
        const response = await fetch(`/api/productos/desactivar/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const result = await response.json();
        if (response.ok) {
          alert("‚úÖ Producto inactivado correctamente");
          // Pod√©s recargar la p√°gina si quer√©s reflejar los cambios
          location.reload();
        } else {
          alert(`‚ùå Error al inactivar: ${result.message}`);
        }
      } catch (error) {
        console.error("Error al inactivar producto:", error);
        alert("‚ùå Error del servidor o de red");
      }
    }
  </script>
  <script>
    const toggle = document.getElementById('modoToggle');
    const label = toggle.nextElementSibling;
    const body = document.body;
    // Verificar si ya est√° guardado el modo
    const modoGuardado = localStorage.getItem('modo');
    if (modoGuardado === 'oscuro') {
      body.classList.add('dark-mode');
      toggle.checked = true;
      label.textContent = '‚òÄÔ∏è';
    }
    // Activar o desactivar modo oscuro manualmente
    toggle.addEventListener('change', () => {
      body.classList.toggle('dark-mode');
      const esOscuro = body.classList.contains('dark-mode');
      localStorage.setItem('modo', esOscuro ? 'oscuro' : 'claro');
      label.textContent = esOscuro ? '‚òÄÔ∏è' : 'üåô';
    });
  </script>
</body>
</html>